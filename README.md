# Todo DB Service

DB Service ‚Äî gRPC-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ (Todo), —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ Go –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

–°–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –≤ PostgreSQL –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–æ gRPC.

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â—É—é —Å—Ö–µ–º—É:

HTTP ‚Üí API Service ‚Üí Kafka ‚Üí gRPC ‚Üí DB Service ‚Üí PostgreSQL


–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **DB Service**.

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π **—Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ**:

1. **Repository layer**
   - –ü—Ä—è–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å PostgreSQL
   - SQL-–∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ ORM
   - –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

2. **Service layer**
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –†–∞–±–æ—Ç–∞ —Å –¥–æ–º–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

3. **gRPC Server layer**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ gRPC-–∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ gRPC status codes
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É

---

## üì¶ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Go**
- **gRPC**
- **PostgreSQL**
- **Docker / Docker Compose**
- **Taskfile**
- **Protobuf**
- **SQL migrations**

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

todo
‚îú‚îÄ‚îÄ db-service
‚îÇ ‚îú‚îÄ‚îÄ cmd/db-service # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ ‚îú‚îÄ‚îÄ internal
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ repository # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ service # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ server # gRPC server
‚îÇ ‚îú‚îÄ‚îÄ proto # gRPC proto-—Ñ–∞–π–ª—ã
‚îÇ ‚îú‚îÄ‚îÄ migrations # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ ‚îî‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Taskfile.yml
‚îî‚îÄ‚îÄ README.md

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

POSTGRES_DSN=postgres://postgres:postgres@localhost:5432/tasks?sslmode=disable
GRPC_ADDR=:50051

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª.

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
üîπ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

Go 1.22+

Docker

Docker Compose

protoc + –ø–ª–∞–≥–∏–Ω—ã:

protoc-gen-go

protoc-gen-go-grpc

üîπ –ó–∞–ø—É—Å–∫ PostgreSQL
task db:up

üîπ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker exec -i todo-postgres psql \
  -U postgres \
  -d tasks < db-service/migrations/001_init.sql

üîπ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ª–æ–∫–∞–ª—å–Ω–æ
task run


gRPC-—Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

localhost:50051

üîπ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
task docker:build
task docker:up

üß¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC-–∫–æ–¥–∞
task proto

üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
Unit + Integration —Ç–µ—Å—Ç—ã
task test

üîç –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è gRPC-—Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

grpcurl

BloomRPC

Postman (gRPC mode)

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ grpcurl:

grpcurl -plaintext localhost:50051 list

üìú –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

CreateTask

GetTaskByID

GetAllTasks

CompleteTask

DeleteTask

üìå –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
–í –ø–ª–∞–Ω–∞—Ö:

API Service (HTTP)

Kafka consumer

Redis cache

Kubernetes deployment

CI/CD (GitHub Actions)

üñ§ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT